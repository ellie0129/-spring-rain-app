import streamlit as st
import numpy as np

st.set_page_config(page_title="ë´„ë¹„ ì ìˆ˜ ë¶„ì„ê¸°", page_icon="ğŸŒ±")
st.title("ğŸŒ§ï¸ ë´„ë¹„(Spring Rain) ì ìˆ˜ ë¶„ì„ê¸°")
st.caption("ì´ì¶˜ìš° êµìˆ˜ë‹˜ì˜ ê¸°ì—…ê°€ì •ì‹  í†µí•©ëª¨í˜• ê¸°ë°˜")

st.markdown("---")
st.subheader("1ï¸âƒ£ ì„¸ë¶€ ì—­ëŸ‰ ì…ë ¥")

# ì„¸ë¶€ ì—­ëŸ‰ êµ¬ì¡°
competence_details = {
    "ë„ì „ì •ì‹ ": ["ìê¸°íš¨ëŠ¥ê°", "ìì‹ ê°", "í—ê·¸ë¦¬ì •ì‹ "],
    "ê³ ìˆ˜ìµ ê¸°ëŒ€": ["ì—´ë§(ì•¼ë§)", "ì¶”ì§„ë ¥", "ì˜ì‚¬ê²°ì •"],
    "ì°½ì˜ì„±": ["ë¦¬ë”ì‹­", "ê´€ë¦¬ì—­ëŸ‰", "ê²½ìŸì  ê³µê²©ì„±"],
    "ì•„ì´ë””ì–´ Â· ìƒìƒë ¥": ["ì¸ì§€ëŠ¥ë ¥(ì§€ì  ëŠ¥ë ¥)", "ì„±ì·¨ìš•êµ¬", "ëª©í‘œ ë‹¬ì„± ì¶”êµ¬"],
    "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": ["ë¶€ì§€ëŸ°í•¨(ì„±ì‹¤ì„±)", "ìˆœì‘ ê±°ë¶€"],
    "ì§„ì·¨ì„±": ["ì—´ì •", "ììœ¨ ì§€í–¥", "ì„ ë„ì "],
    "ìœ„í—˜ê°ìˆ˜ì„±": ["ì¸ë‚´ì‹¬", "ìœ„í—˜ì„ í˜¸", "CSR/CSV", "ì±…ì„ê°(ì±…ì„ì˜ì‹)"],
    "í˜ì‹ ì„±": ["ê¸°ì—…ìœ¤ë¦¬", "ì°½ì˜ì„±", "ë³€í™” ë° í˜ì‹  ì ê·¹ ìˆ˜ìš©"]
}

# ì„¸ë¶€ ì—­ëŸ‰ ì ìˆ˜ ì…ë ¥ ë° í‰ê·  ê³„ì‚°
competence_scores = {}
for bundle, traits in competence_details.items():
    st.markdown(f"**{bundle}**")
    values = []
    for trait in traits:
        score = st.slider(f"- {trait}", 0.0, 1.0, 0.5, 0.01)
        values.append(score)
    competence_scores[bundle] = np.mean(values)

# ê³„ì‚° í•¨ìˆ˜
def compute_spring_rain_score(scores):
    comp_to_att = {
        "ë„ì „ì •ì‹ ": ["ì°½ì¡° Â· ë°œëª… Â· ê°œë°œ", "ì¡°í•© Â· ì¤‘ê°œ"],
        "ê³ ìˆ˜ìµ ê¸°ëŒ€": ["ì¡°í•© Â· ì¤‘ê°œ", "í˜ì‹  Â· ë³€í™” Â· ê°œì„ "],
        "ì°½ì˜ì„±": ["í˜ì‹  Â· ë³€í™” Â· ê°œì„ ", "ë„ì „ Â· ê·¹ë³µ"],
        "ì•„ì´ë””ì–´ Â· ìƒìƒë ¥": ["ë„ì „ Â· ê·¹ë³µ", "ì£¼ë„ Â· ì‚¬ì—…í™”"],
        "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": ["ì£¼ë„ Â· ì‚¬ì—…í™”", "ì—­ë°œìƒ Â· ì¬í•´ì„"],
        "ì§„ì·¨ì„±": ["ì—­ë°œìƒ Â· ì¬í•´ì„", "ê°œì²™ Â· íƒí—˜ Â· ëª¨í—˜"],
        "ìœ„í—˜ê°ìˆ˜ì„±": ["ê°œì²™ Â· íƒí—˜ Â· ëª¨í—˜", "ë°œê²¬ Â· ë°œìƒ Â· ìƒìƒ"],
        "í˜ì‹ ì„±": ["ë°œê²¬ Â· ë°œìƒ Â· ìƒìƒ", "ì°½ì¡° Â· ë°œëª… Â· ê°œë°œ"]
    }
    att_scores = {k: 0.0 for k in [
        "ì°½ì¡° Â· ë°œëª… Â· ê°œë°œ", "ì¡°í•© Â· ì¤‘ê°œ", "í˜ì‹  Â· ë³€í™” Â· ê°œì„ ", "ë„ì „ Â· ê·¹ë³µ",
        "ì£¼ë„ Â· ì‚¬ì—…í™”", "ì—­ë°œìƒ Â· ì¬í•´ì„", "ê°œì²™ Â· íƒí—˜ Â· ëª¨í—˜", "ë°œê²¬ Â· ë°œìƒ Â· ìƒìƒ"]}
    for comp, val in scores.items():
        for att in comp_to_att[comp]:
            att_scores[att] += val * 0.5
    att_scores = {k: min(v, 1.0) for k, v in att_scores.items()}

    att_to_mis = {
        "ì°½ì¡° Â· ë°œëª… Â· ê°œë°œ": {"ê¸°íšŒì¶”êµ¬": 0.25, "ë¯¸ë˜ì§€í–¥": 0.25},
        "ì¡°í•© Â· ì¤‘ê°œ": {"ê¸°íšŒì¶”êµ¬": 0.5},
        "í˜ì‹  Â· ë³€í™” Â· ê°œì„ ": {"ê¸°íšŒì¶”êµ¬": 0.25, "ê³µë™ì²´ë°œì „": 0.25},
        "ë„ì „ Â· ê·¹ë³µ": {"ê³µë™ì²´ë°œì „": 0.5},
        "ì£¼ë„ Â· ì‚¬ì—…í™”": {"ê³µë™ì²´ë°œì „": 0.25, "ì°½ì¡°ì íŒŒê´´": 0.25},
        "ì—­ë°œìƒ Â· ì¬í•´ì„": {"ì°½ì¡°ì íŒŒê´´": 0.5},
        "ê°œì²™ Â· íƒí—˜ Â· ëª¨í—˜": {"ì°½ì¡°ì íŒŒê´´": 0.25, "ë¯¸ë˜ì§€í–¥": 0.25},
        "ë°œê²¬ Â· ë°œìƒ Â· ìƒìƒ": {"ë¯¸ë˜ì§€í–¥": 0.5}
    }
    mis_scores = {k: 0.0 for k in ["ê¸°íšŒì¶”êµ¬", "ê³µë™ì²´ë°œì „", "ì°½ì¡°ì íŒŒê´´", "ë¯¸ë˜ì§€í–¥"]}
    for att, val in att_scores.items():
        for mis, w in att_to_mis[att].items():
            mis_scores[mis] += val * w
    mis_scores = {k: min(v, 1.0) for k, v in mis_scores.items()}

    outcome = sum(mis_scores.values()) * 0.25
    bombi = outcome * 100
    return att_scores, mis_scores, outcome, bombi

# ì‹¤í–‰ ë²„íŠ¼
if st.button("ğŸ’§ ë´„ë¹„ ì ìˆ˜ ê³„ì‚°í•˜ê¸°"):
    att, mis, out, bombi = compute_spring_rain_score(competence_scores)
    st.markdown("---")
    st.subheader("2ï¸âƒ£ ë¶„ì„ ê²°ê³¼")

    st.write("**ğŸŒ¿ Attitude Layer**")
    for k, v in att.items():
        st.write(f"- {k}: {v:.2f}")

    st.write("**ğŸŒ Mission Layer**")
    for k, v in mis.items():
        st.write(f"- {k}: {v:.2f}")

    st.write("**ğŸŒ§ï¸ Outcome Layer**")
    st.success(f"í†µí•© ì„±ê³¼ ì ìˆ˜: {out:.2f} â†’ ë´„ë¹„ ì ìˆ˜: {bombi:.2f}ì ")
