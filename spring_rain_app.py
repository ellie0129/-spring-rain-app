# spring_rain_app.py (2025 ì™„ì„±ë³¸)
# Streamlit ê¸°ë°˜ ë´„ë¹„ ì ìˆ˜ ë¶„ì„ê¸° (ì‹ ëª¨í˜• + UI + ì˜ˆì‹œ + ì‹œê°í™” í¬í•¨)

import streamlit as st
import numpy as np
import plotly.graph_objects as go

st.set_page_config(page_title="ë´„ë¹„ ì ìˆ˜ ë¶„ì„ê¸°", page_icon="ğŸŒ±", layout="wide")

st.title("ğŸŒ§ï¸ ë´„ë¹„(Spring Rain) ì ìˆ˜ ë¶„ì„ê¸°")
st.caption("ì„œìš¸ì‹œë¦½ëŒ€í•™êµ | ì´ì¶˜ìš° êµìˆ˜ë‹˜ì˜ ê¸°ì—…ê°€ì •ì‹  í†µí•©ëª¨í˜• ê¸°ë°˜")

menu = st.sidebar.radio("ë©”ë‰´", ["ë¶„ì„ê¸°", "ëª¨í˜• ì„¤ëª…"])

if menu == "ëª¨í˜• ì„¤ëª…":
    st.header("ğŸ“˜ ê¸°ì—…ê°€ì •ì‹  í†µí•©ëª¨í˜• êµ¬ì¡° ì„¤ëª…")
    st.markdown("""
    ### ğŸ”„ ì „ì²´ ë ˆì´ì–´ êµ¬ì¡°

    1. **Outcome Layer (ì„±ê³¼)**
    2. **Mission Layer (ì‚¬ëª…)**
    3. **Attitude Layer (íƒœë„)**
    4. **Competence Layer (ì—­ëŸ‰)**

    #### â–¶ï¸ ì ìˆ˜ ì „ì´ êµ¬ì¡°
    - ê° í•˜ìœ„ ìš”ì†ŒëŠ” ìì‹ ì´ ì†í•œ ì—­ëŸ‰ ë²ˆë“¤ ì ìˆ˜ì— `1/n`ì”© ê¸°ì—¬
    - ê° ì—­ëŸ‰ ë²ˆë“¤ì€ 2ê°œì˜ íƒœë„ ìš”ì†Œì— 0.5ì”© ì „ì´
    - ê° íƒœë„ ìš”ì†ŒëŠ” ì‚¬ëª… ë ˆì´ì–´ì— ê°€ì¤‘ì¹˜ë¡œ ì „ì´
    - ì‚¬ëª… ì ìˆ˜ í‰ê·  â†’ ìµœì¢… Outcome ì ìˆ˜

    ---

    ### ğŸ§¬ ê¸°ì—…ê°€ì •ì‹  í†µí•©ëª¨í˜• ì‹œê° ìë£Œ
    ![í†µí•©ëª¨í˜• ì´ë¯¸ì§€](https://raw.githubusercontent.com/itisbreeze/spring-rain-model/main/integrated_model.png)
    """)

if menu == "ë¶„ì„ê¸°":
    st.subheader("ğŸ¤– AI ê¸°ë°˜ ì¸ë¬¼ ë¶„ì„")

    sample_profiles = {
        "ì œí”„ ë² ì¡°ìŠ¤": {
            "ë„ì „ì •ì‹ ": 0.93,
            "ìµœê³ Â·ìµœì´ˆÂ·ìµœì‹ Â·ìœ ì¼ ì§€í–¥": 0.91,
            "Integrity": 0.87,
            "ì°½ì¡°ì  ë¬¸ì œí•´ê²°": 0.91,
            "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": 0.89,
            "ì§„ì·¨ì„±(ì„ ë„ì„±)": 0.94,
            "ìœ„í—˜ê°ìˆ˜ì„±": 0.91,
            "í˜ì‹ ì„±": 0.95
        },
        "ê¹€ìŠ¬ì•„": {
            "ë„ì „ì •ì‹ ": 0.87,
            "ìµœê³ Â·ìµœì´ˆÂ·ìµœì‹ Â·ìœ ì¼ ì§€í–¥": 0.86,
            "Integrity": 0.85,
            "ì°½ì¡°ì  ë¬¸ì œí•´ê²°": 0.89,
            "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": 0.84,
            "ì§„ì·¨ì„±(ì„ ë„ì„±)": 0.90,
            "ìœ„í—˜ê°ìˆ˜ì„±": 0.82,
            "í˜ì‹ ì„±": 0.91
        },
        "ì •ì£¼ì˜": {
            "ë„ì „ì •ì‹ ": 0.96,
            "ìµœê³ Â·ìµœì´ˆÂ·ìµœì‹ Â·ìœ ì¼ ì§€í–¥": 0.94,
            "Integrity": 0.92,
            "ì°½ì¡°ì  ë¬¸ì œí•´ê²°": 0.90,
            "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": 0.93,
            "ì§„ì·¨ì„±(ì„ ë„ì„±)": 0.95,
            "ìœ„í—˜ê°ìˆ˜ì„±": 0.92,
            "í˜ì‹ ì„±": 0.93
        }
    }

    selected_name = st.text_input("ì¸ë¬¼ ì´ë¦„ ì…ë ¥")

    if selected_name in sample_profiles:
        competence_scores = sample_profiles[selected_name]
        st.success(f"âœ… '{selected_name}'ì˜ í”„ë¡œíŒŒì¼ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.")
    else:
        st.info("âœï¸ ì•„ë˜ì—ì„œ ì§ì ‘ ì„¸ë¶€ ì—­ëŸ‰ì„ ì…ë ¥í•´ë„ ë©ë‹ˆë‹¤.")
        competence_details = {
            "ë„ì „ì •ì‹ ": ["ìê¸°íš¨ëŠ¥ê°, ìì‹ ê°", "ì„±ì·¨ ìš•êµ¬", "í—ê·¸ë¦¬ì •ì‹ , ëª©í‘œ ë‹¬ì„± ì¶”êµ¬"],
            "ìµœê³ Â·ìµœì´ˆÂ·ìµœì‹ Â·ìœ ì¼ ì§€í–¥": ["ì—´ë§(ì•¼ë§)", "ì¶”ì§„ë ¥, ì‹¤í–‰ë ¥", "ê²°ë‹¨ë ¥(ì˜ì‚¬ê²°ì •)", "ê³ ìˆ˜ìµ ê¸°ëŒ€"],
            "Integrity": ["ë¦¬ë”ì‹­", "ì‚¬ì—…ìˆ˜ì™„", "ê²½ì˜ ê´€ë¦¬ ì—­ëŸ‰", "ì‹ ìš©, ì‹ ë¢°", "ê·¼ë©´, ê²€ì†Œ, ì„±ì‹¤ì„±"],
            "ì°½ì¡°ì  ë¬¸ì œí•´ê²°": ["ê¸ì •ì , ë‚™ê´€ì ", "í†µì°°ë ¥, ì•ˆëª©", "ì•„ì´ë””ì–´, ìƒìƒë ¥, í˜¸ê¸°ì‹¬, íƒêµ¬", "ì¸ì§€ ëŠ¥ë ¥"],
            "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": ["ìì•„ì‹¤í˜„", "ììœ¨ì„± ì§€í–¥", "ìˆœì‘ ê±°ë¶€", "ì—­ê²½ ê·¹ë³µ"],
            "ì§„ì·¨ì„±(ì„ ë„ì„±)": ["ì—´ì •", "ë†’ì€ ëª¨í˜¸ì„± ì¸ë‚´ë„", "ê²½ìŸì  ê³µê²©ì„±", "ì„ ë„ì "],
            "ìœ„í—˜ê°ìˆ˜ì„±": ["ì¸ë‚´ì‹¬", "ìœ„í—˜ì„ í˜¸", "CSR/CSV", "ì±…ì„ê°"],
            "í˜ì‹ ì„±": ["ê¸°ì—…ìœ¤ë¦¬", "ì°½ì˜ì„±", "ë³€í™” ë° í˜ì‹  ì ê·¹ ìˆ˜ìš©"]
        }
        competence_scores = {}
        for bundle, traits in competence_details.items():
            st.markdown(f"#### {bundle}")
            scores = [st.slider(f"{trait}", 0.0, 1.0, 0.0, 0.01) for trait in traits]
            competence_scores[bundle] = np.mean(scores)

    def compute_bombi_score(scores):
        comp_to_att = {
            "ë„ì „ì •ì‹ ": ["ì°½ì¡° Â· ë°œëª… Â· ê°œë°œ", "ì¡°í•© Â· ì¤‘ê°œ"],
            "ìµœê³ Â·ìµœì´ˆÂ·ìµœì‹ Â·ìœ ì¼ ì§€í–¥": ["ì¡°í•© Â· ì¤‘ê°œ", "í˜ì‹  Â· ë³€í™” Â· ê°œì„ "],
            "Integrity": ["í˜ì‹  Â· ë³€í™” Â· ê°œì„ ", "ë„ì „ Â· ê·¹ë³µ"],
            "ì°½ì¡°ì  ë¬¸ì œí•´ê²°": ["ë„ì „ Â· ê·¹ë³µ", "ì£¼ë„ Â· ì‚¬ì—…í™”"],
            "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": ["ì£¼ë„ Â· ì‚¬ì—…í™”", "ì—­ë°œìƒ Â· ì¬í•´ì„"],
            "ì§„ì·¨ì„±(ì„ ë„ì„±)": ["ì—­ë°œìƒ Â· ì¬í•´ì„", "ê°œì²™ Â· íƒí—˜ Â· ëª¨í—˜"],
            "ìœ„í—˜ê°ìˆ˜ì„±": ["ê°œì²™ Â· íƒí—˜ Â· ëª¨í—˜", "ë°œê²¬ Â· ë°œìƒ Â· ìƒìƒ"],
            "í˜ì‹ ì„±": ["ë°œê²¬ Â· ë°œìƒ Â· ìƒìƒ", "ì°½ì¡° Â· ë°œëª… Â· ê°œë°œ"]
        }
        attitude = {k: 0.0 for v in comp_to_att.values() for k in v}
        for comp, val in scores.items():
            for att in comp_to_att[comp]:
                attitude[att] += val * 0.5
        attitude = {k: min(v, 1.0) for k, v in attitude.items()}

        att_to_mis = {
            "ì°½ì¡° Â· ë°œëª… Â· ê°œë°œ": {"ê¸°íšŒì¶”êµ¬": 0.25, "ë¯¸ë˜ì§€í–¥": 0.25},
            "ì¡°í•© Â· ì¤‘ê°œ": {"ê¸°íšŒì¶”êµ¬": 0.5},
            "í˜ì‹  Â· ë³€í™” Â· ê°œì„ ": {"ê¸°íšŒì¶”êµ¬": 0.25, "ê³µë™ì²´ë°œì „": 0.25},
            "ë„ì „ Â· ê·¹ë³µ": {"ê³µë™ì²´ë°œì „": 0.5},
            "ì£¼ë„ Â· ì‚¬ì—…í™”": {"ê³µë™ì²´ë°œì „": 0.25, "ì°½ì¡°ì íŒŒê´´": 0.25},
            "ì—­ë°œìƒ Â· ì¬í•´ì„": {"ì°½ì¡°ì íŒŒê´´": 0.5},
            "ê°œì²™ Â· íƒí—˜ Â· ëª¨í—˜": {"ì°½ì¡°ì íŒŒê´´": 0.25, "ë¯¸ë˜ì§€í–¥": 0.25},
            "ë°œê²¬ Â· ë°œìƒ Â· ìƒìƒ": {"ë¯¸ë˜ì§€í–¥": 0.5}
        }
        mission = {k: 0.0 for k in ["ê¸°íšŒì¶”êµ¬", "ê³µë™ì²´ë°œì „", "ì°½ì¡°ì íŒŒê´´", "ë¯¸ë˜ì§€í–¥"]}
        for att, val in attitude.items():
            for mis, w in att_to_mis.get(att, {}).items():
                mission[mis] += val * w
        mission = {k: min(v, 1.0) for k, v in mission.items()}
        outcome_score = np.mean(list(mission.values()))
        return outcome_score, attitude, mission

    if competence_scores:
        outcome, attitude, mission = compute_bombi_score(competence_scores)
        st.markdown("---")
        st.metric("ğŸŒŸ ìµœì¢… ë´„ë¹„ ì ìˆ˜", f"{round(outcome * 100, 2)} / 100")
        with st.expander("ğŸŒ€ íƒœë„ ë ˆì´ì–´ ì ìˆ˜ ë³´ê¸°"):
            st.json(attitude)
        with st.expander("ğŸ¯ ì‚¬ëª… ë ˆì´ì–´ ì ìˆ˜ ë³´ê¸°"):
            st.json(mission)

        st.markdown("---")
        st.subheader("ğŸ“ˆ ë ˆì´ë” ì°¨íŠ¸")
        fig = go.Figure()
        fig.add_trace(go.Scatterpolar(
            r=list(competence_scores.values()),
            theta=list(competence_scores.keys()),
            fill='toself',
            name='ì—­ëŸ‰ í”„ë¡œíŒŒì¼'
        ))
        fig.update_layout(polar=dict(radialaxis=dict(visible=True, range=[0, 1])), showlegend=False)
        st.plotly_chart(fig, use_container_width=True)