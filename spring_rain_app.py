
import streamlit as st
import numpy as np
import plotly.graph_objects as go

st.set_page_config(page_title="ë´„ë¹„ ì ìˆ˜ ë¶„ì„ê¸°", page_icon="ğŸŒ±", layout="wide")

st.title("ğŸŒ§ï¸ ë´„ë¹„(Spring Rain) ì ìˆ˜ ë¶„ì„ê¸°")
st.caption("ì´ì¶˜ìš° êµìˆ˜ë‹˜ì˜ ê¸°ì—…ê°€ì •ì‹  í†µí•©ëª¨í˜• ê¸°ë°˜")

menu = st.sidebar.radio("ë©”ë‰´", ["ë¶„ì„ê¸°", "ëª¨í˜• ì„¤ëª…"])

if menu == "ëª¨í˜• ì„¤ëª…":
    st.header("ğŸ“˜ ê¸°ì—…ê°€ì •ì‹  í†µí•©ëª¨í˜• êµ¬ì¡° ì„¤ëª…")
    st.markdown("""
    ### ğŸ”„ ì „ì²´ ë ˆì´ì–´ êµ¬ì¡°

    ì´ ì•±ì€ ì´ì¶˜ìš° êµìˆ˜ë‹˜ì˜ [ê¸°ì—…ê°€ì •ì‹  í†µí•©ëª¨í˜•]ì— ë”°ë¼ ì´ 4ê°œì˜ ë ˆì´ì–´ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

    1. **Outcome Layer (ì„±ê³¼)**: ìµœì¢… ì„±ì·¨ - `ë¶€ì˜ ì¦ëŒ€`, `ê°€ì¹˜ ì°½ì¶œ`
    2. **Mission Layer (ì‚¬ëª…)**: ì‚¬ì—…ì˜ ì§€í–¥ì  - `ê¸°íšŒì¶”êµ¬`, `ê³µë™ì²´ë°œì „`, `ì°½ì¡°ì íŒŒê´´`, `ë¯¸ë˜ì§€í–¥`
    3. **Attitude Layer (í–‰ë™ì–‘ì‹)**: ê¸°ì—…ê°€ì˜ íƒœë„ì™€ ì ‘ê·¼ ë°©ì‹ (ì´ 8ê°œ)
    4. **Competence Layer (ì—­ëŸ‰ ë²ˆë“¤)**: ì„¸ë¶€ ì—­ëŸ‰ ìš”ì†Œë“¤ë¡œ êµ¬ì„±ëœ ê¸°ë³¸ê¸° (ì´ 8ê°œ)

    ê° ë ˆì´ì–´ëŠ” ì•„ë˜ë¡œë¶€í„° ìœ„ë¡œ ì ìˆ˜ê°€ **ì „ì´(transfer)** ë˜ì–´ ì˜¬ë¼ê°‘ë‹ˆë‹¤.

    ---

    ### ğŸ§¬ ì ìˆ˜ ì „ì´ íë¦„ ìš”ì•½

    - **ì—­ëŸ‰(Competence)** â†’ íƒœë„(Attitude)ë¡œ: ê° ì—­ëŸ‰ ë²ˆë“¤ì´ 2ê°œ íƒœë„ì— 0.5ì ì”© ê¸°ì—¬
    - **íƒœë„(Attitude)** â†’ ì‚¬ëª…(Mission)ìœ¼ë¡œ: ê° íƒœë„ê°€ ê´€ë ¨ëœ ì‚¬ëª…ì— 0.25~0.5ì  ë¹„ì¤‘ìœ¼ë¡œ ì—°ê²°
    - **ì‚¬ëª…(Mission)** â†’ ì„±ê³¼(Outcome)ë¡œ: ê° ì‚¬ëª…ì´ `ë¶€ì˜ ì¦ëŒ€` & `ê°€ì¹˜ ì°½ì¶œ`ì— ê°ê° 0.25ì  ê¸°ì—¬

    ì´ êµ¬ì¡°ë¥¼ í†µí•´ ìµœì¢… **Outcome Layer**ì—ì„œ 1ì (100ì  ë§Œì ) ê¸°ì¤€ìœ¼ë¡œ `ë´„ë¹„ ì ìˆ˜`ê°€ ê³„ì‚°ë©ë‹ˆë‹¤.

    ---

    ### ğŸ§­ ì‹œê°ì  êµ¬ì¡° ìš”ì•½

    ì•„ë˜ëŠ” ì „ì²´ í†µí•©ëª¨í˜•ì˜ ê³„ì¸µì  íë¦„ì…ë‹ˆë‹¤:

    ``Competence`` â†’ ``Attitude`` â†’ ``Mission`` â†’ ``Outcome``

    ë˜ëŠ” ì‰½ê²Œ í‘œí˜„í•˜ë©´:

    > ë¶€ì§€ëŸ°í•¨/ì°½ì˜ì„±/ë„ì „ì •ì‹  â†’ í–‰ë™ì–‘ì‹ë“¤ â†’ ì‚¬íšŒ/ì‹œì¥ ì‚¬ëª… â†’ ê°€ì¹˜/ë¶€ ì°½ì¶œ

    ---

    ### ğŸ–¼ï¸ ëª¨í˜• ë„ì‹ ì´ë¯¸ì§€

    ğŸ“Œ *ì´ ëª¨í˜•ì€ ì‹¤ì œ ë…¼ë¬¸(ì´ì¶˜ìš°, 2019 ë° 2020)ì—ì„œ ë°œì·Œí•œ ì´ë¯¸ì§€ë¡œ ì‹œê°í™”í•œ ê²ƒì…ë‹ˆë‹¤.*
    """)
    st.image("https://raw.githubusercontent.com/ellie0129/spring-rain-app/main/assets/1ce34f642e1b80808f4edd8cc64b1a95.png", use_container_width=True)
    st.markdown("---")
else:
    st.subheader("ğŸ¤– AI ê¸°ë°˜ ì¸ë¬¼ ë¶„ì„")

    st.markdown("AIê°€ ë¶„ì„í•  ì¸ë¬¼ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: **ì œí”„ ë² ì¡°ìŠ¤**, **ê¹€ìŠ¬ì•„**, **ì •ì£¼ì˜**)")
    selected_name = st.text_input("ì¸ë¬¼ ì´ë¦„ ì…ë ¥")

    sample_profiles = {
        "ì œí”„ ë² ì¡°ìŠ¤": {
            "ë„ì „ì •ì‹ ": 0.9, "ê³ ìˆ˜ìµ ê¸°ëŒ€": 1.0, "ì°½ì˜ì„±": 0.85, "ì•„ì´ë””ì–´ Â· ìƒìƒë ¥": 0.7,
            "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": 0.8, "ì§„ì·¨ì„±": 0.95, "ìœ„í—˜ê°ìˆ˜ì„±": 0.9, "í˜ì‹ ì„±": 0.9
        },
        "ê¹€ìŠ¬ì•„": {
            "ë„ì „ì •ì‹ ": 0.85, "ê³ ìˆ˜ìµ ê¸°ëŒ€": 0.75, "ì°½ì˜ì„±": 0.8, "ì•„ì´ë””ì–´ Â· ìƒìƒë ¥": 0.9,
            "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": 0.85, "ì§„ì·¨ì„±": 0.9, "ìœ„í—˜ê°ìˆ˜ì„±": 0.75, "í˜ì‹ ì„±": 0.8
        },
        "ì •ì£¼ì˜": {
            "ë„ì „ì •ì‹ ": 1.0, "ê³ ìˆ˜ìµ ê¸°ëŒ€": 0.95, "ì°½ì˜ì„±": 0.8, "ì•„ì´ë””ì–´ Â· ìƒìƒë ¥": 0.6,
            "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": 1.0, "ì§„ì·¨ì„±": 0.9, "ìœ„í—˜ê°ìˆ˜ì„±": 1.0, "í˜ì‹ ì„±": 0.75
        },
        "ì´ì¶˜ìš°": {
            "ë„ì „ì •ì‹ ": 1.0, "ê³ ìˆ˜ìµ ê¸°ëŒ€": 1.0, "ì°½ì˜ì„±": 1.0, "ì•„ì´ë””ì–´ Â· ìƒìƒë ¥": 1.0,
            "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": 1.0, "ì§„ì·¨ì„±": 1.0, "ìœ„í—˜ê°ìˆ˜ì„±": 1.0, "í˜ì‹ ì„±": 1.0
        }
    }

    if selected_name == "ì´ì¶˜ìš°":
        st.success(f"âœ… '{selected_name}'ì˜ í”„ë¡œíŒŒì¼ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.")
        st.write("**ì´ì¶˜ìš° êµìˆ˜ë‹˜ì€ ì˜ì‹¬í•  ì—¬ì§€ ì—†ì´ ì™„ë²½í•œ ê¸°ì—…ê°€ì´ì‹­ë‹ˆë‹¤!**")
        competence_scores = sample_profiles[selected_name]
    elif selected_name in sample_profiles:
        st.success(f"âœ… '{selected_name}'ì˜ í”„ë¡œíŒŒì¼ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.")
        competence_scores = sample_profiles[selected_name]
    else:
        st.info("ì•„ë˜ì—ì„œ ì§ì ‘ ì„¸ë¶€ ì—­ëŸ‰ì„ ì…ë ¥í•´ë„ ë©ë‹ˆë‹¤.")
        st.subheader("1ï¸âƒ£ ì„¸ë¶€ ì—­ëŸ‰ ì§ì ‘ ì…ë ¥")

        bundles = {
            "ë„ì „ì •ì‹ ": ["ìê¸°íš¨ëŠ¥ê°", "ìì‹ ê°", "í—ê·¸ë¦¬ì •ì‹ "],
            "ê³ ìˆ˜ìµ ê¸°ëŒ€": ["ì—´ë§(ì•¼ë§)", "ì¶”ì§„ë ¥", "ì˜ì‚¬ê²°ì •"],
            "ì°½ì˜ì„±": ["ë¦¬ë”ì‹­", "ê´€ë¦¬ì—­ëŸ‰", "ê²½ìŸì  ê³µê²©ì„±"],
            "ì•„ì´ë””ì–´ Â· ìƒìƒë ¥": ["ì¸ì§€ëŠ¥ë ¥", "ì„±ì·¨ìš•êµ¬", "ëª©í‘œ ë‹¬ì„± ì¶”êµ¬"],
            "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": ["ë¶€ì§€ëŸ°í•¨", "ìˆœì‘ ê±°ë¶€"],
            "ì§„ì·¨ì„±": ["ì—´ì •", "ììœ¨ì§€í–¥", "ì„ ë„ì "],
            "ìœ„í—˜ê°ìˆ˜ì„±": ["ì¸ë‚´ì‹¬", "ìœ„í—˜ì„ í˜¸", "CSR/CSV", "ì±…ì„ê°"],
            "í˜ì‹ ì„±": ["ê¸°ì—…ìœ¤ë¦¬", "ì°½ì˜ì„±", "ë³€í™” ìˆ˜ìš©"]
        }

        competence_scores = {}
        for bundle, traits in bundles.items():
            cols = st.columns(len(traits))
            values = []
            for i, trait in enumerate(traits):
                values.append(cols[i].slider(f"{bundle} - {trait}", 0.0, 1.0, 0.5, 0.01))
            competence_scores[bundle] = np.mean(values)

        if st.button("ğŸ’§ ì…ë ¥ ì™„ë£Œ í›„ ë¶„ì„ ì‹œì‘"):
            selected_name = "ì…ë ¥ì™„ë£Œ"

    if selected_name:
        def compute_layers(comp):
            comp = {k: min(v, 1.0) for k, v in comp.items()}
            comp_to_att = {
                "ë„ì „ì •ì‹ ": ["ì°½ì¡° Â· ë°œëª… Â· ê°œë°œ", "ì¡°í•© Â· ì¤‘ê°œ"],
                "ê³ ìˆ˜ìµ ê¸°ëŒ€": ["ì¡°í•© Â· ì¤‘ê°œ", "í˜ì‹  Â· ë³€í™” Â· ê°œì„ "],
                "ì°½ì˜ì„±": ["í˜ì‹  Â· ë³€í™” Â· ê°œì„ ", "ë„ì „ Â· ê·¹ë³µ"],
                "ì•„ì´ë””ì–´ Â· ìƒìƒë ¥": ["ë„ì „ Â· ê·¹ë³µ", "ì£¼ë„ Â· ì‚¬ì—…í™”"],
                "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": ["ì£¼ë„ Â· ì‚¬ì—…í™”", "ì—­ë°œìƒ Â· ì¬í•´ì„"],
                "ì§„ì·¨ì„±": ["ì—­ë°œìƒ Â· ì¬í•´ì„", "ê°œì²™ Â· íƒí—˜ Â· ëª¨í—˜"],
                "ìœ„í—˜ê°ìˆ˜ì„±": ["ê°œì²™ Â· íƒí—˜ Â· ëª¨í—˜", "ë°œê²¬ Â· ë°œìƒ Â· ìƒìƒ"],
                "í˜ì‹ ì„±": ["ë°œê²¬ Â· ë°œìƒ Â· ìƒìƒ", "ì°½ì¡° Â· ë°œëª… Â· ê°œë°œ"]
            }
            att = {}
            for c, val in comp.items():
                for a in comp_to_att[c]:
                    att[a] = att.get(a, 0) + val * 0.5
            att = {k: min(v, 1.0) for k, v in att.items()}
            att_to_mis = {
                "ì°½ì¡° Â· ë°œëª… Â· ê°œë°œ": {"ê¸°íšŒì¶”êµ¬": 0.25, "ë¯¸ë˜ì§€í–¥": 0.25},
                "ì¡°í•© Â· ì¤‘ê°œ": {"ê¸°íšŒì¶”êµ¬": 0.5},
                "í˜ì‹  Â· ë³€í™” Â· ê°œì„ ": {"ê¸°íšŒì¶”êµ¬": 0.25, "ê³µë™ì²´ë°œì „": 0.25},
                "ë„ì „ Â· ê·¹ë³µ": {"ê³µë™ì²´ë°œì „": 0.5},
                "ì£¼ë„ Â· ì‚¬ì—…í™”": {"ê³µë™ì²´ë°œì „": 0.25, "ì°½ì¡°ì íŒŒê´´": 0.25},
                "ì—­ë°œìƒ Â· ì¬í•´ì„": {"ì°½ì¡°ì íŒŒê´´": 0.5},
                "ê°œì²™ Â· íƒí—˜ Â· ëª¨í—˜": {"ì°½ì¡°ì íŒŒê´´": 0.25, "ë¯¸ë˜ì§€í–¥": 0.25},
                "ë°œê²¬ Â· ë°œìƒ Â· ìƒìƒ": {"ë¯¸ë˜ì§€í–¥": 0.5}
            }
            mis = {}
            for a, val in att.items():
                for m, w in att_to_mis[a].items():
                    mis[m] = mis.get(m, 0) + val * w
            mis = {k: min(v, 1.0) for k, v in mis.items()}
            outcome = round(min(sum(mis.values()) * 0.25, 1.0), 3)
            return comp, att, mis, outcome

        comp, att, mis, out = compute_layers(competence_scores)

        st.subheader("ğŸ“Š ì—­ëŸ‰ ë²ˆë“¤ ì ìˆ˜ (Competence Layer)")
        st.dataframe({k: [f"{v:.2f}"] for k, v in comp.items()})

        def radar(title, data):
            fig = go.Figure()
            labels = list(data.keys())
            values = list(data.values()) + [list(data.values())[0]]
            labels += [labels[0]]
            fig.add_trace(go.Scatterpolar(r=values, theta=labels, fill='toself'))
            fig.update_layout(polar=dict(radialaxis=dict(visible=True, range=[0, 1])), showlegend=False)
            st.markdown(f"#### {title}")
            st.plotly_chart(fig, use_container_width=True)

        radar("ğŸ•¸ï¸ Competence Layer", comp)
        radar("ğŸŒ€ Attitude Layer", att)
        radar("ğŸ¯ Mission Layer", mis)

        st.subheader("ğŸ¯ Mission ì ìˆ˜ (ì‚¬ëª… ë ˆì´ì–´)")
        st.dataframe({k: [f"{v:.2f}"] for k, v in mis.items()})

        st.subheader("ğŸŒ§ï¸ Outcome ì ìˆ˜ (ë´„ë¹„ ì ìˆ˜)")
        st.success(f"ìµœì¢… ë´„ë¹„ ì ìˆ˜: {out * 100:.2f}ì ")

        st.markdown("---")
        st.caption("ë¶„ì„ê¸° ê²°ê³¼ëŠ” ë‹¨ìˆœ ì°¸ê³ ìš©ì´ë©°, ì‹¤ì œ ê¸°ì—…ê°€ì •ì‹  ì—­ëŸ‰ í‰ê°€ë¥¼ ìœ„í•œ ì •ë°€ ë¶„ì„ì€ ì „ë¬¸ê°€ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.")
