import streamlit as st
import numpy as np
import plotly.graph_objects as go

st.set_page_config(page_title="ë´„ë¹„ ì ìˆ˜ ë¶„ì„ê¸°", page_icon="ğŸŒ±")
st.title("ğŸŒ§ï¸ ë´„ë¹„(Spring Rain) ì ìˆ˜ ë¶„ì„ê¸°")
st.caption("ì´ì¶˜ìš° êµìˆ˜ë‹˜ì˜ ê¸°ì—…ê°€ì •ì‹  í†µí•©ëª¨í˜• ê¸°ë°˜")

# íƒ­ êµ¬ì„±
menu = st.sidebar.radio("ë©”ë‰´", ["ë¶„ì„ê¸°", "ëª¨í˜• ì„¤ëª…"])

if menu == "ëª¨í˜• ì„¤ëª…":
    st.header("ğŸ“˜ ê¸°ì—…ê°€ì •ì‹  í†µí•©ëª¨í˜• êµ¬ì¡° ì„¤ëª…")
    st.markdown("""
    ### ğŸ”„ ì „ì²´ ë ˆì´ì–´ êµ¬ì¡°
    
    ì´ ì•±ì€ ì´ì¶˜ìš° êµìˆ˜ë‹˜ì˜ [ê¸°ì—…ê°€ì •ì‹  í†µí•©ëª¨í˜•]ì— ë”°ë¼ ì´ 4ê°œì˜ ë ˆì´ì–´ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

    1. **Outcome Layer (ì„±ê³¼)**: ìµœì¢… ì„±ì·¨ - `ë¶€ì˜ ì¦ëŒ€`, `ê°€ì¹˜ ì°½ì¶œ`
    2. **Mission Layer (ì‚¬ëª…)**: ì‚¬ì—…ì˜ ì§€í–¥ì  - `ê¸°íšŒì¶”êµ¬`, `ê³µë™ì²´ë°œì „`, `ì°½ì¡°ì íŒŒê´´`, `ë¯¸ë˜ì§€í–¥`
    3. **Attitude Layer (í–‰ë™ì–‘ì‹)**: ê¸°ì—…ê°€ì˜ íƒœë„ì™€ ì ‘ê·¼ ë°©ì‹ (ì´ 8ê°œ)
    4. **Competence Layer (ì—­ëŸ‰ ë²ˆë“¤)**: ì„¸ë¶€ ì—­ëŸ‰ ìš”ì†Œë“¤ë¡œ êµ¬ì„±ëœ ê¸°ë³¸ê¸° (ì´ 8ê°œ)

    ê° ë ˆì´ì–´ëŠ” ì•„ë˜ë¡œë¶€í„° ìœ„ë¡œ ì ìˆ˜ê°€ **ì „ì´(transfer)** ë˜ì–´ ì˜¬ë¼ê°‘ë‹ˆë‹¤.

    ---

    ### ğŸ§¬ ì ìˆ˜ ì „ì´ íë¦„ ìš”ì•½

    - **ì—­ëŸ‰(Competence)** â†’ íƒœë„(Attitude)ë¡œ: ê° ì—­ëŸ‰ ë²ˆë“¤ì´ 2ê°œ íƒœë„ì— 0.5ì ì”© ê¸°ì—¬
    - **íƒœë„(Attitude)** â†’ ì‚¬ëª…(Mission)ìœ¼ë¡œ: ê° íƒœë„ê°€ ê´€ë ¨ëœ ì‚¬ëª…ì— 0.25~0.5ì  ë¹„ì¤‘ìœ¼ë¡œ ì—°ê²°
    - **ì‚¬ëª…(Mission)** â†’ ì„±ê³¼(Outcome)ë¡œ: ê° ì‚¬ëª…ì´ `ë¶€ì˜ ì¦ëŒ€` & `ê°€ì¹˜ ì°½ì¶œ`ì— ê°ê° 0.25ì  ê¸°ì—¬
    
    ì´ êµ¬ì¡°ë¥¼ í†µí•´ ìµœì¢… **Outcome Layer**ì—ì„œ 1ì (100ì  ë§Œì ) ê¸°ì¤€ìœ¼ë¡œ `ë´„ë¹„ ì ìˆ˜`ê°€ ê³„ì‚°ë©ë‹ˆë‹¤.

    ---

    ### ğŸ§­ ì‹œê°ì  êµ¬ì¡° ìš”ì•½

    ì•„ë˜ëŠ” ì „ì²´ í†µí•©ëª¨í˜•ì˜ ê³„ì¸µì  íë¦„ì…ë‹ˆë‹¤:

    ``Competence`` â†’ ``Attitude`` â†’ ``Mission`` â†’ ``Outcome``
    
    ë˜ëŠ” ì‰½ê²Œ í‘œí˜„í•˜ë©´:

    > ë¶€ì§€ëŸ°í•¨/ì°½ì˜ì„±/ë„ì „ì •ì‹  â†’ í–‰ë™ì–‘ì‹ë“¤ â†’ ì‚¬íšŒ/ì‹œì¥ ì‚¬ëª… â†’ ê°€ì¹˜/ë¶€ ì°½ì¶œ

    ---

    ### ğŸ–¼ï¸ ëª¨í˜• ë„ì‹ ì´ë¯¸ì§€

    ğŸ“Œ *ì´ ëª¨í˜•ì€ ì‹¤ì œ ë…¼ë¬¸(ì´ì¶˜ìš°, 2023)ì—ì„œ ë°œì·Œí•œ ì´ë¯¸ì§€ë¡œ ì‹œê°í™”í•œ ê²ƒì…ë‹ˆë‹¤.*

    (Streamlit ì•± ì™„ì„± í›„ ì—¬ê¸°ì— ì´ë¯¸ì§€ ì‚½ì… ê°€ëŠ¥: `st.image()`)

    ---

    ### ğŸ“‹ ê° ë ˆì´ì–´ë³„ êµ¬ì„± ìš”ì•½í‘œ

    | Layer | êµ¬ì„±ìš”ì†Œ ìˆ˜ | ì˜ˆì‹œ |
    |-------|-------------|------|
    | Outcome | 2 | ë¶€ì˜ ì¦ëŒ€, ê°€ì¹˜ ì°½ì¶œ |
    | Mission | 4 | ê¸°íšŒì¶”êµ¬, ê³µë™ì²´ë°œì „ ë“± |
    | Attitude | 8 | ë„ì „ Â· ê·¹ë³µ, ì—­ë°œìƒ Â· ì¬í•´ì„ ë“± |
    | Competence | 8 | ì°½ì˜ì„±, ì§„ì·¨ì„±, ìœ„í—˜ê°ìˆ˜ì„± ë“± |

    ---

    > **TIP**: ë¶„ì„ê¸° íƒ­ìœ¼ë¡œ ëŒì•„ê°€ì„œ ì§ì ‘ ì ìˆ˜ë¥¼ ì…ë ¥í•´ë³´ë©° ì´ êµ¬ì¡°ë¥¼ ì²´í—˜í•´ë³´ì„¸ìš”!
    """)

else:
    st.subheader("ğŸ¤– AI ê¸°ë°˜ ì¸ë¬¼ ë¶„ì„")

    sample_profiles = {
        "ì œí”„ ë² ì¡°ìŠ¤": {
            "ë„ì „ì •ì‹ ": 0.9,
            "ê³ ìˆ˜ìµ ê¸°ëŒ€": 1.0,
            "ì°½ì˜ì„±": 0.85,
            "ì•„ì´ë””ì–´ Â· ìƒìƒë ¥": 0.7,
            "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": 0.8,
            "ì§„ì·¨ì„±": 0.95,
            "ìœ„í—˜ê°ìˆ˜ì„±": 0.9,
            "í˜ì‹ ì„±": 0.9
        },
        "ê¹€ìŠ¬ì•„": {
            "ë„ì „ì •ì‹ ": 0.85,
            "ê³ ìˆ˜ìµ ê¸°ëŒ€": 0.75,
            "ì°½ì˜ì„±": 0.8,
            "ì•„ì´ë””ì–´ Â· ìƒìƒë ¥": 0.9,
            "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": 0.85,
            "ì§„ì·¨ì„±": 0.9,
            "ìœ„í—˜ê°ìˆ˜ì„±": 0.75,
            "í˜ì‹ ì„±": 0.8
        },
        "ì •ì£¼ì˜": {
            "ë„ì „ì •ì‹ ": 1.0,
            "ê³ ìˆ˜ìµ ê¸°ëŒ€": 0.95,
            "ì°½ì˜ì„±": 0.8,
            "ì•„ì´ë””ì–´ Â· ìƒìƒë ¥": 0.6,
            "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": 1.0,
            "ì§„ì·¨ì„±": 0.9,
            "ìœ„í—˜ê°ìˆ˜ì„±": 1.0,
            "í˜ì‹ ì„±": 0.75
        }
    }

    selected_name = st.text_input("AIê°€ ë¶„ì„í•  ì¸ë¬¼ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì œí”„ ë² ì¡°ìŠ¤, ê¹€ìŠ¬ì•„, ì •ì£¼ì˜)")

    if selected_name in sample_profiles:
        st.success(f"âœ… '{selected_name}'ì˜ í”„ë¡œíŒŒì¼ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.")
        competence_scores = sample_profiles[selected_name]
    else:
        st.info("ì•„ë˜ì—ì„œ ì§ì ‘ ì„¸ë¶€ ì—­ëŸ‰ì„ ì…ë ¥í•´ë„ ë©ë‹ˆë‹¤.")
        st.subheader("1ï¸âƒ£ ì„¸ë¶€ ì—­ëŸ‰ ì…ë ¥")
        competence_details = {
            "ë„ì „ì •ì‹ ": ["ìê¸°íš¨ëŠ¥ê°", "ìì‹ ê°", "í—ê·¸ë¦¬ì •ì‹ "],
            "ê³ ìˆ˜ìµ ê¸°ëŒ€": ["ì—´ë§(ì•¼ë§)", "ì¶”ì§„ë ¥", "ì˜ì‚¬ê²°ì •"],
            "ì°½ì˜ì„±": ["ë¦¬ë”ì‹­", "ê´€ë¦¬ì—­ëŸ‰", "ê²½ìŸì  ê³µê²©ì„±"],
            "ì•„ì´ë””ì–´ Â· ìƒìƒë ¥": ["ì¸ì§€ëŠ¥ë ¥(ì§€ì  ëŠ¥ë ¥)", "ì„±ì·¨ìš•êµ¬", "ëª©í‘œ ë‹¬ì„± ì¶”êµ¬"],
            "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": ["ë¶€ì§€ëŸ°í•¨(ì„±ì‹¤ì„±)", "ìˆœì‘ ê±°ë¶€"],
            "ì§„ì·¨ì„±": ["ì—´ì •", "ììœ¨ ì§€í–¥", "ì„ ë„ì "],
            "ìœ„í—˜ê°ìˆ˜ì„±": ["ì¸ë‚´ì‹¬", "ìœ„í—˜ì„ í˜¸", "CSR/CSV", "ì±…ì„ê°(ì±…ì„ì˜ì‹)"],
            "í˜ì‹ ì„±": ["ê¸°ì—…ìœ¤ë¦¬", "ì°½ì˜ì„±", "ë³€í™” ë° í˜ì‹  ì ê·¹ ìˆ˜ìš©"]
        }
        competence_scores = {}
        for bundle, traits in competence_details.items():
            st.markdown(f"**{bundle}**")
            values = []
            for trait in traits:
                score = st.slider(f"- {trait}", 0.0, 1.0, 0.5, 0.01)
                values.append(score)
            competence_scores[bundle] = np.mean(values)

    def compute_spring_rain_score(scores):
        comp_to_att = {
            "ë„ì „ì •ì‹ ": ["ì°½ì¡° Â· ë°œëª… Â· ê°œë°œ", "ì¡°í•© Â· ì¤‘ê°œ"],
            "ê³ ìˆ˜ìµ ê¸°ëŒ€": ["ì¡°í•© Â· ì¤‘ê°œ", "í˜ì‹  Â· ë³€í™” Â· ê°œì„ "],
            "ì°½ì˜ì„±": ["í˜ì‹  Â· ë³€í™” Â· ê°œì„ ", "ë„ì „ Â· ê·¹ë³µ"],
            "ì•„ì´ë””ì–´ Â· ìƒìƒë ¥": ["ë„ì „ Â· ê·¹ë³µ", "ì£¼ë„ Â· ì‚¬ì—…í™”"],
            "ë…ë¦½ì„± Â· ìê¸°ê³ ìš© Â· ìê¸°ì„¸ê³„": ["ì£¼ë„ Â· ì‚¬ì—…í™”", "ì—­ë°œìƒ Â· ì¬í•´ì„"],
            "ì§„ì·¨ì„±": ["ì—­ë°œìƒ Â· ì¬í•´ì„", "ê°œì²™ Â· íƒí—˜ Â· ëª¨í—˜"],
            "ìœ„í—˜ê°ìˆ˜ì„±": ["ê°œì²™ Â· íƒí—˜ Â· ëª¨í—˜", "ë°œê²¬ Â· ë°œìƒ Â· ìƒìƒ"],
            "í˜ì‹ ì„±": ["ë°œê²¬ Â· ë°œìƒ Â· ìƒìƒ", "ì°½ì¡° Â· ë°œëª… Â· ê°œë°œ"]
        }
        att_scores = {k: 0.0 for k in [
            "ì°½ì¡° Â· ë°œëª… Â· ê°œë°œ", "ì¡°í•© Â· ì¤‘ê°œ", "í˜ì‹  Â· ë³€í™” Â· ê°œì„ ", "ë„ì „ Â· ê·¹ë³µ",
            "ì£¼ë„ Â· ì‚¬ì—…í™”", "ì—­ë°œìƒ Â· ì¬í•´ì„", "ê°œì²™ Â· íƒí—˜ Â· ëª¨í—˜", "ë°œê²¬ Â· ë°œìƒ Â· ìƒìƒ"]}
        for comp, val in scores.items():
            for att in comp_to_att[comp]:
                att_scores[att] += val * 0.5
        att_scores = {k: min(v, 1.0) for k, v in att_scores.items()}

        att_to_mis = {
            "ì°½ì¡° Â· ë°œëª… Â· ê°œë°œ": {"ê¸°íšŒì¶”êµ¬": 0.25, "ë¯¸ë˜ì§€í–¥": 0.25},
            "ì¡°í•© Â· ì¤‘ê°œ": {"ê¸°íšŒì¶”êµ¬": 0.5},
            "í˜ì‹  Â· ë³€í™” Â· ê°œì„ ": {"ê¸°íšŒì¶”êµ¬": 0.25, "ê³µë™ì²´ë°œì „": 0.25},
            "ë„ì „ Â· ê·¹ë³µ": {"ê³µë™ì²´ë°œì „": 0.5},
            "ì£¼ë„ Â· ì‚¬ì—…í™”": {"ê³µë™ì²´ë°œì „": 0.25, "ì°½ì¡°ì íŒŒê´´": 0.25},
            "ì—­ë°œìƒ Â· ì¬í•´ì„": {"ì°½ì¡°ì íŒŒê´´": 0.5},
            "ê°œì²™ Â· íƒí—˜ Â· ëª¨í—˜": {"ì°½ì¡°ì íŒŒê´´": 0.25, "ë¯¸ë˜ì§€í–¥": 0.25},
            "ë°œê²¬ Â· ë°œìƒ Â· ìƒìƒ": {"ë¯¸ë˜ì§€í–¥": 0.5}
        }
        mis_scores = {k: 0.0 for k in ["ê¸°íšŒì¶”êµ¬", "ê³µë™ì²´ë°œì „", "ì°½ì¡°ì íŒŒê´´", "ë¯¸ë˜ì§€í–¥"]}
        for att, val in att_scores.items():
            for mis, w in att_to_mis[att].items():
                mis_scores[mis] += val * w
        mis_scores = {k: min(v, 1.0) for k, v in mis_scores.items()}

        outcome = sum(mis_scores.values()) * 0.25
        bombi = outcome * 100
        return att_scores, mis_scores, outcome, bombi

    if st.button("ğŸ’§ ë´„ë¹„ ì ìˆ˜ ê³„ì‚°í•˜ê¸°"):
        att, mis, out, bombi = compute_spring_rain_score(competence_scores)
        st.markdown("---")
        st.subheader("2ï¸âƒ£ ë¶„ì„ ê²°ê³¼")

        st.write("**ğŸŒ¿ Attitude Layer**")
        for k, v in att.items():
            st.write(f"- {k}: {v:.2f}")

        st.write("**ğŸŒ Mission Layer**")
        for k, v in mis.items():
            st.write(f"- {k}: {v:.2f}")

        st.write("**ğŸŒ§ï¸ Outcome Layer**")
        st.success(f"í†µí•© ì„±ê³¼ ì ìˆ˜: {out:.2f} â†’ ë´„ë¹„ ì ìˆ˜: {bombi:.2f}ì ")

        st.markdown("---")
        st.subheader("ğŸ“Š ì—­ëŸ‰ ë²ˆë“¤ ì ìˆ˜ ë ˆì´ë” ì°¨íŠ¸")
        radar_labels = list(competence_scores.keys())
        radar_values = list(competence_scores.values())
        radar_values.append(radar_values[0])
        radar_labels.append(radar_labels[0])

        fig = go.Figure()
        fig.add_trace(go.Scatterpolar(
            r=radar_values,
            theta=radar_labels,
            fill='toself',
            name='ì—­ëŸ‰ í”„ë¡œíŒŒì¼'
        ))
        fig.update_layout(
            polar=dict(radialaxis=dict(visible=True, range=[0, 1])),
            showlegend=False,
            margin=dict(l=30, r=30, t=30, b=30),
            height=500
        )
        st.plotly_chart(fig, use_container_width=True)
